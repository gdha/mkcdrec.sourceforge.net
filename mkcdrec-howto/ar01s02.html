<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>2. Make the Disaster Recovery CD-ROM</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"><link rel="start" href="index.html" title="mkCDrec Howto"><link rel="up" href="index.html" title="mkCDrec Howto"><link rel="prev" href="ar01s01.html" title="1. Introduction"><link rel="next" href="ar01s03.html" title="3. Booting from a mkCDrec CD-ROM"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2. Make the Disaster Recovery CD-ROM</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s01.html">Terug</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ar01s03.html">Volgende</a></td></tr></table><hr></div><div class="sect1" lang="nl-NL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e157"></a>2. Make the Disaster Recovery CD-ROM</h2></div></div></div><p>After the &#8220;<span class="emphasis"><em>make test</em></span>&#8221; was successful you can run mkCDrec in two different modes, interactive and in batch.</p><p></p><p>To run in interactive mode just type &#8220;<span class="emphasis"><em>make</em></span>&#8221; and the following screen will be displayed:</p><p></p><p><img src="resources/main_menu.jpg" width="425"></p><p></p><p>To run in batch mode, then you have to add an option to the make command. The batch mode commands are listed in the same order as the interactive mode:</p><div class="orderedlist"><ol type="1"><li><p>Make rescue</p></li><li><p>Make CD-ROM</p></li><li><p>Make path DESTINATION_PATH=/foo</p></li><li><p>Make device</p></li></ol></div><p></p><p>Another important option to make is &#8220;clean&#8221;:</p><p><span><strong class="command"><code class="filename"><em class="replaceable"><code># make clean</code></em></code></strong></span></p><p>will remove all temporary files made by mkCDrec including the ISO9960 images created.</p><div class="sect2" lang="nl-NL"><div class="titlepage"><div><div><h3 class="title"><a name="d0e200"></a>2.1. Rescue CD-ROM only (no backups)</h3></div></div></div><p>If you select option 1 from the menu then you will create a small ISO9960 image without backups, but still useful as a simple rescue CD-ROM built on your Linux platform. You can even burn the image to a business card size CD-ROM. Of course, you cannot restore backups with this CD-ROM unless you have your complete system file systems on another backups media, such as Tivoli Storage Manager or Data Protector.</p><p></p></div><div class="sect2" lang="nl-NL"><div class="titlepage"><div><div><h3 class="title"><a name="d0e206"></a>2.2. Into /tmp/backup (to burn on CDROM)</h3></div></div></div><p>Option 2 will create a rescue CD-ROM including a complete backup of your system&#8217;s file systems. Of course it will exclude any files or file systems you set in <code class="filename">Config.sh</code> <em class="firstterm">EXCLUDE_LIST</em>.</p><p>If necessary mkCDrec will create multi-volume CD-ROM images or can even burn a DVD too.</p></div><div class="sect2" lang="nl-NL"><div class="titlepage"><div><div><h3 class="title"><a name="d0e219"></a>2.3. Enter another path (spare disk or NFS)</h3></div></div></div><p>Option 3 expects that you NFS mounted the ISOFS_DIR (see Config.sh file)! Still a rescue CD-ROM will be made but the destination path on the CD-ROM will point to the NFS mount point and it will try to auto-mount it. If that does not work, then try it manually before starting a restore, clone operation.</p></div><div class="sect2" lang="nl-NL"><div class="titlepage"><div><div><h3 class="title"><a name="d0e224"></a>2.4. Enter (remote) tape device</h3></div></div></div><p>Option 4 will prompt for a no-rewinding tape device, either local or remote accessible, e.g. /dev/nst0.</p><p>Also now a mkCDrec ISO image will be created that must be used for a recovery operation.</p><p>So, to restore a system you first need to boot from the CD-ROM and then insert the tape into the tape drive (local or remote) and start the restore to retrieve the data from tape.</p><p>Note that there is the possibility to create an OBDR tape (no CD-ROM image will be burned).</p></div><div class="sect2" lang="nl-NL"><div class="titlepage"><div><div><h3 class="title"><a name="d0e235"></a>2.5. Quit</h3></div></div></div><p>What can we say about this option? Quit.</p><p></p></div><div class="sect2" lang="nl-NL"><div class="titlepage"><div><div><h3 class="title"><a name="d0e241"></a>2.6. Encrypting the backups</h3></div></div></div><p>If in the Config.sh file you activated encryption cipher, e.g. openssl Blowfish cipher</p><p><span class="emphasis"><em>CIPHER=bf</em></span></p><p></p><p>Then you will be prompted twice for a password:</p><p></p><p><span class="inlinemediaobject"><img src="resources/mkCDrec_howto_html_43fc4a37.jpg" width="461"></span></p><p></p></div><div class="sect2" lang="nl-NL"><div class="titlepage"><div><div><h3 class="title"><a name="d0e258"></a>2.7. Backups without encryptions</h3></div></div></div><p>When in the <code class="filename">Config.sh</code> file <em class="firstterm">CIPHER=&#8221;&#8221;</em> (default value) then the backups will not be encrypted.</p><p></p><p>In interactive mode you will see the following question appearing:</p><p></p><p><img src="resources/option_2_question.jpg" width="461"></p><p></p><p>If there are file systems listed that should not be backup&#8217;ed then press Control-C now and unmount those file systems immediately. In batch mode the above screen will not be disabled!</p><p></p><p>Thereafter, just run &#8220;<span class="emphasis"><em>make</em></span>&#8221; command again to restart the backup process.</p></div><div class="sect2" lang="nl-NL"><div class="titlepage"><div><div><h3 class="title"><a name="d0e284"></a>2.8. During the backups</h3></div></div></div><p>What follows is a series of screen dumps of such a run to give you an impression of how it looks.</p><p></p><p><img src="resources/mkcdrec_in_progress1.jpg" width="638"></p><p></p><p>It will start with some primary checking, including if encryption will be used or not. The network settings are stored in a system file. Later when you boot from the mkCDrec CD-ROM it will allocate the IP address as found while making the disaster recovery image, unless you have chosen DHCP setting in the Config.sh configuration file, or if you are using DHCP right now.</p><p></p><p><img src="resources/mkcdrec_in_progress2.jpg" width="638"></p><p></p><p>Then it will create the root file system for the RAM disk. In above picture the RAM disk is created as an ext2 file system. It is also possible to use another file system as ext3, minix, reiserfs, xfs or jfs, but you loose so much RAM disk space on journaling it is unwise to use journaling file systems such as ext3, reiserfs, xfs and jfs. Ext2 is good enough for a RAM disk anyway as it lives in memory only and not an a real hard disk.</p><p>The root file system is mounting and filled with directories and binaries (stripped binaries) as seen in following screen shots.</p><p></p><p><img src="resources/mkcdrec_in_progress3.jpg" width="390"></p><p></p><p>Somewhere after copying the binaries and libraries mkCDrec will create lots of scripts and rescue files in the root file system <code class="filename">etc/recovery</code> directory.</p><p></p><p><img src="resources/mkcdrec_in_progress4.jpg" width="567"></p><p></p><p>After a while the root file system is complete and will get unmounted and compressed.</p><p></p><p><img src="resources/mkcdrec_in_progress5.jpg" width="638"></p><p></p><p>After the RAM root file system is compressed, and only when the mkCDrec Utilities were installed you will see the following <span class="emphasis"><em>cfg2html</em></span> run. This creates 2 important files (one as plain text and one in HTML format) that contain a complete overview of your current system&#8217;s hardware and software installed, including all the configuration settings. For this alone it is worth installing the mkCDrec Utilities. The information that these files contain will be very appreciated in case of trouble! Believe me.</p><p></p><p><img src="resources/mkcdrec_in_progress6.jpg" width="602"></p><p></p><p>The next important phase in mkCDrec disaster recovery image making is the creation of the initial RAM disk which is a small boot image that loads some loadable modules in memory to mount the CD-ROM and bootstrap into the bigger root file system RAM disk.</p><p></p><p><img src="resources/mkcdrec_in_progress7.jpg" width="531"></p><p></p><p>As you can see not much binaries are needed in the initial RAM disk.</p><p></p><p>After the initial RAM disk mkCDrec will create a bootable floppy in memory, but it is possible to write to a real floppy too if the size permits. See the Config.sh file to toggle this.</p><p>The boot floppy contains the Linux kernel and the initial RAM disk. Once the boot floppy is done syslinux will make it bootable.</p><p>If you have installed mkCDrec Utilities you will notice that the behavior is somewhat different as it will use isolinux directly to boot from the CD-ROM instead of emulating a boot floppy booting from a CD-ROM.</p><p></p><p><img src="resources/mkcdrec_in_progress8.jpg" width="638"></p><p></p><p>After the boot floppy it is time to create the backups of the mounted file systems using GNU tar.</p><p>The behavior can be different as seen below if you have selected backup to tape or another disk.</p><p></p><p><img src="resources/mkcdrec_in_progress9.jpg" width="638"></p><p></p><p>The cutstream program is nothing more then a calculator to split the backups into 650 Mbytes images so mkCDrec can create an ISO9660 image of it. The image size is a variable that is defined in the Config.sh file (MAXCDSIZE).</p><p></p><p><img src="resources/mkcdrec_in_progress10.jpg" width="585"></p><p></p><p>mkCDrec uses mkisofs to create a bootable El-Torito CD-ROM.</p><p></p><p><img src="resources/mkcdrec_in_progress11.jpg" width="638"></p><p></p><p>Once the CDrec.iso has been created by mkisofs it will be checked to see whether it is useable and an md5sum checksum will be implanted in the image too.</p><p></p><p><img src="resources/mkcdrec_in_progress12.jpg" width="425"></p><p></p><p>If you have selected to use a CDRW (variable in Config.sh) it will blank the CD, otherwise it will skip this step.</p><p></p><p><img src="resources/mkcdrec_in_progress13.jpg" width="638"></p><p></p><p>Burning the CDrec.iso image to the CDR(W) is done with cdrecord.</p><p></p><p><img src="resources/mkcdrec_in_progress14.jpg" width="638"></p><p></p><p>Above error will normally not been seen as in this case vmware was used to capture the screen shots, but it gives you an impression that you will be given a second chance to write the image to CDR(W) if the first one fails. If it still fails it will move the <code class="filename">CDrec.iso</code> image to another filename and continue with the backups.</p><p>After the entire file systems are backup&#8217;ed the last CDrec.iso image will be written.</p><p></p><p></p><p></p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s01.html">Terug</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ar01s03.html">Volgende</a></td></tr><tr><td width="40%" align="left" valign="top">1. Introduction&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Begin</a></td><td width="40%" align="right" valign="top">&nbsp;3. Booting from a mkCDrec CD-ROM</td></tr></table></div></body></html>